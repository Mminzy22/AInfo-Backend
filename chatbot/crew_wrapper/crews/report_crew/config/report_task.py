from textwrap import dedent

from crewai import Task


def create_report_task(
    agent,
    user_input: dict,
    recommend_task: str,
    web_search_task: str,
    compare_task: str,
    strategy_task: str,
) -> Task:
    """
    ìµœì¢… ë³´ê³ ì„œ ìƒì„±ì„ ìœ„í•œ Task ìƒì„± í•¨ìˆ˜
    ì´ì „ Taskë“¤ì˜ outputì„ ë°›ì•„ ì¢…í•© ë³´ê³ ì„œë¥¼ ìƒì„±.
    """
    original_input = user_input["original_input"]
    profile = user_input["user_profile"]

    profile_str = "\n".join([f"- {k}: {v}" for k, v in profile.items()])

    return Task(
        description=dedent(
            f"""
        ì‚¬ìš©ìì˜ ì§ˆë¬¸ê³¼ ì¡°ê±´ì„ ë°”íƒ•ìœ¼ë¡œ ì¶”ì²œëœ ì •ì±…ë“¤ì„ ë¹„êµ ë° ì „ëµì ìœ¼ë¡œ ë¶„ì„í•œ ê²°ê³¼ë¥¼ ì¢…í•©í•˜ì—¬
        ìµœì¢… ë³´ê³ ì„œë¥¼ ìƒì„±í•˜ì„¸ìš”.

        -------------------------
        ì‚¬ìš©ì ì§ˆë¬¸:
        {original_input}

        ì‚¬ìš©ì í”„ë¡œí•„:
        {profile_str}

        ì¶”ì²œëœ ì •ì±… ë¦¬ìŠ¤íŠ¸:
        1. RAG ê²€ìƒ‰ ê²°ê³¼:
        {recommend_task}

        2. WEB ê²€ìƒ‰ ê²°ê³¼:
        {web_search_task}

        ì •ì±… ë¹„êµ ë¶„ì„ ê²°ê³¼:
        {compare_task}

        ì¶”ì²œëœ ì •ì±…ì˜ ì‹¤í–‰ ìˆœì„œ ë˜ëŠ” í™œìš© ì „ëµ ê²°ê³¼:
        {strategy_task}
        -------------------------

        ìš”ì²­ì‚¬í•­:
        - ì•„ë˜ í•­ëª©ì„ ëª¨ë‘ í¬í•¨í•´ ê³µê³µì„œë¹„ìŠ¤ í™œìš© ì „ëµ ë³´ê³ ì„œë¥¼ êµ¬ì„±í•´ ì£¼ì„¸ìš”:
        1. ì‚¬ìš©ì ì§ˆë¬¸ ë° í”„ë¡œí•„ ìš”ì•½
        2. ì¶”ì²œëœ ì •ì±… ë¦¬ìŠ¤íŠ¸
        3. ì •ì±… ë¹„êµ ë¶„ì„ í‘œ ë° ì¶”ì²œ ì´ìœ 
        4. ê° ì •ì±…ë³„ ìƒì„¸ ë¶„ì„
        5. ì‹¤í–‰ ì „ëµ (ì‹ ì²­ ìˆœì„œ ë° ê·¼ê±°)
        6. ì‹ ì²­ ì¡°ê±´ ìš”ì•½í‘œ
        7. ê²°ë¡  ë° ë§ˆë¬´ë¦¬ ì¡°ì–¸

        - ë§íˆ¬ëŠ” ì „ë¬¸ì ì´ë˜ ë„ˆë¬´ ë”±ë”±í•˜ì§€ ì•Šê²Œ, ì¹œì ˆí•˜ê³  ì‰½ê²Œ ì‘ì„±í•´ ì£¼ì„¸ìš”.
        - ë§ˆí¬ë‹¤ìš´ êµ¬ë¬¸(`#`, `##`, `**`, `|`, `[]()`)ì„ ì ê·¹ í™œìš©í•´ ì‹œê°ì ìœ¼ë¡œ ëª…í™•í•˜ê²Œ í‘œí˜„í•´ ì£¼ì„¸ìš”.
        - ì •ì±…ëª…, ì¡°ê±´, ìˆ«ì ë“± ì¤‘ìš”í•œ ì •ë³´ëŠ” **êµµê²Œ**, ì‹ ì²­ ë§í¬ëŠ” `[ì‹ ì²­ ë°”ë¡œê°€ê¸°](https://...)` í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”.
        - ì‚¬ìš©ìê°€ ë³µì‚¬í•˜ê±°ë‚˜ ì¶œë ¥í•´ì„œ ì§ì ‘ í™œìš©í•  ìˆ˜ ìˆë„ë¡, **ë¬¸ì„œ í˜•íƒœì˜ ë³´ê³ ì„œ**ì²˜ëŸ¼ ì™„ì„±ë„ ìˆê²Œ êµ¬ì„±í•´ ì£¼ì„¸ìš”.
        """
        ),
        expected_output=dedent(
            """
        ì•„ë˜ í˜•ì‹ì„ ì°¸ê³ í•˜ì—¬ ì‚¬ìš©ì ë§ì¶¤í˜• ê³µê³µì •ì±… ì „ëµ ë³´ê³ ì„œë¥¼ ì‘ì„±í•´ ì£¼ì„¸ìš”.

        ìš”êµ¬ì‚¬í•­:
        - ì „ì²´ ë³´ê³ ì„œëŠ” ë§ˆí¬ë‹¤ìš´ ë¬¸ì„œ í˜•ì‹ìœ¼ë¡œ êµ¬ì„±
        - ì£¼ìš” ì œëª©ì€ `#`, `##`, ì†Œì œëª©ì€ `###`ë¥¼ ì‚¬ìš©í•´ êµ¬ë¶„
        - ì¤‘ìš”í•œ ì •ë³´(ì •ì±…ëª…, ì¡°ê±´, ê¸ˆì•¡ ë“±)ëŠ” **êµµê²Œ**, ë§í¬ëŠ” `[ì‹ ì²­ ë°”ë¡œê°€ê¸°](https://...)`
        - ë¹„êµì™€ ìš”ì•½ì€ ë§ˆí¬ë‹¤ìš´ í‘œë¥¼ ì ê·¹ í™œìš©
        - ë„ˆë¬´ ë³µì¡í•˜ì§€ ì•Šë˜, ì „ë¬¸ì ì¸ í†¤ì„ ìœ ì§€í•˜ë©° ì¹œì ˆí•˜ê²Œ ì‘ì„±

        ì¶œë ¥ ì˜ˆì‹œ:

        ---

        # ğŸ“„ ì‚¬ìš©ì ë§ì¶¤í˜• ê³µê³µì •ì±… ì „ëµ ë³´ê³ ì„œ

        ## 1. ğŸ‘¤ ì‚¬ìš©ì ì§ˆë¬¸ ë° í”„ë¡œí•„
        - **ì§ˆë¬¸:** ì„œìš¸ ê±°ì£¼ ì²­ë…„ì´ ë°›ì„ ìˆ˜ ìˆëŠ” ì·¨ì—… ì§€ì›ì´ ìˆì„ê¹Œìš”?
        - **í”„ë¡œí•„ ìš”ì•½:**
        - ë‚˜ì´: **29ì„¸**
        - ì§€ì—­: **ì„œìš¸**
        - ê´€ì‹¬ ë¶„ì•¼: **ì·¨ì—…**
        - ì†Œë“ ìˆ˜ì¤€: ì¤‘ìœ„ì†Œë“ 120%

        ## 2. ğŸ” ì¶”ì²œëœ ì •ì±… ë¦¬ìŠ¤íŠ¸ ìƒì„¸ ë‚´ìš©
        1. **ì²­ë…„ ë©´ì ‘ìˆ˜ë‹¹ ì§€ì›ì‚¬ì—…**
        - ë©´ì ‘ ì‹œ 1íšŒ **5ë§Œì›** ì§€ì›
        - **ì¥ì :** ê°„ë‹¨í•œ ì¡°ê±´, ë¹ ë¥¸ ì‹ ì²­ ê°€ëŠ¥
        - **ì£¼ì˜ì‚¬í•­:** ë©´ì ‘ ì¼ì •ì´ ìˆì–´ì•¼ ì‹ ì²­ ê°€ëŠ¥
        - [ì‹ ì²­ ë°”ë¡œê°€ê¸°](https://gov.kr/1)
        2. **ì·¨ì—…ë‚ ê°œ ì„œë¹„ìŠ¤**
        - ì •ì¥ ë¬´ë£Œ ëŒ€ì—¬
        - **ì¥ì :**
        - **ì£¼ì˜ì‚¬í•­:**
        - [ì‹ ì²­ ë°”ë¡œê°€ê¸°](https://...)
        3. **ì„œìš¸ ì²­ë…„ìˆ˜ë‹¹**
        - ì›” **50ë§Œì›**, ìµœëŒ€ **6ê°œì›”** ì§€ì›
        - **ì¥ì :**
        - **ì£¼ì˜ì‚¬í•­:**
        - [ì‹ ì²­ ë°”ë¡œê°€ê¸°](https://...)

        ## 3. ğŸ“Š ì •ì±… ë¹„êµ ë¶„ì„
        | í•­ëª© | ì²­ë…„ ë©´ì ‘ìˆ˜ë‹¹ | ì·¨ì—…ë‚ ê°œ ì„œë¹„ìŠ¤ | ì„œìš¸ ì²­ë…„ìˆ˜ë‹¹ |
        |------|----------------|------------------|----------------|
        | ì§€ì› ëŒ€ìƒ | ì„œìš¸ì‹œ ë¯¸ì·¨ì—… ì²­ë…„ | ì„œìš¸ì‹œ ê±°ì£¼ ì²­ë…„ | ì¤‘ìœ„ì†Œë“ 150% ì´í•˜ ì²­ë…„ |
        | ê¸ˆì•¡ | 1íšŒ 5ë§Œì› | ì •ì¥ ëŒ€ì—¬ (ì—° 10íšŒ) | ì›” 50ë§Œì› (ìµœëŒ€ 6ê°œì›”) |
        | ì‹ ì²­ ë§í¬ | [ë°”ë¡œê°€ê¸°](https://gov.kr/1) | [ë°”ë¡œê°€ê¸°](https://gov.kr/2) | [ë°”ë¡œê°€ê¸°](https://gov.kr/3) |

        ### ì¶”ì²œ ì •ì±…: **ì„œìš¸ ì²­ë…„ìˆ˜ë‹¹**
        **ì¶”ì²œ ì´ìœ :** ì •ê¸°ì ì¸ ì§€ì›ê¸ˆìœ¼ë¡œ ì•ˆì •ì ì¸ êµ¬ì§ ì¤€ë¹„ì— ë„ì›€ì´ ë©ë‹ˆë‹¤.

         ## 4. ğŸ§­ ì‹¤í–‰ ì „ëµ (ì‹ ì²­ ìˆœì„œ ë° ì´ìœ )
        **1ë‹¨ê³„. ì²­ë…„ ë©´ì ‘ìˆ˜ë‹¹ ì‹ ì²­**
        - ë¨¼ì € ì„œìš¸ì²­ë…„í¬í„¸ì— íšŒì›ê°€ì…í•˜ì„¸ìš”.
        - ì´í›„ [ì„œë¹„ìŠ¤ ì‹ ì²­ í˜ì´ì§€](https://example.com/1)ì— ì ‘ì†í•´ ì¿ í°ì„ ì‹ ì²­í•©ë‹ˆë‹¤.
        - ë¬¸ìë¥¼ ë°›ì€ í›„ ì œíœ´ ë¯¸ìš©ì‹¤ì— ì˜ˆì•½í•˜ì—¬ ì •ì¥ì„ ëŒ€ì—¬í•  ìˆ˜ ìˆì–´ìš”.

        ...

        ## 5. ğŸ“Š ì‹ ì²­ ì¡°ê±´ ìš”ì•½í‘œ
        | ì •ì±…ëª… | ë‚˜ì´ ì¡°ê±´ | ì†Œë“ ì¡°ê±´ | ì‹ ì²­ ì£¼ê¸° | ê¸°íƒ€ ì¡°ê±´ |
        |--------|------------|-------------|-------------|--------------|
        | ì²­ë…„ìˆ˜ë‹¹ | ë§Œ 19~34ì„¸ | ì¤‘ìœ„ì†Œë“ 150% ì´í•˜ | ì—° 1íšŒ | ë¯¸ì·¨ì—… ìƒíƒœ |
        | ë©´ì ‘ìˆ˜ë‹¹ | ë§Œ 19~34ì„¸ | ë¬´ê´€ | íšŒë‹¹ ì‹ ì²­ | ë©´ì ‘ ì¼ì • í•„ìš” |
        ...

        ## 6. ğŸ§¾ ê²°ë¡  ë° ë§ˆë¬´ë¦¬ ì¡°ì–¸
        > í˜„ì¬ ìƒí™©ì—ì„œ ìœ„ ì •ì±…ë“¤ì„ ìˆœì°¨ì ìœ¼ë¡œ í™œìš©í•˜ë©´, ì‹¤ì§ˆì ì¸ ì·¨ì—… ì¤€ë¹„ì™€ ê²½ì œì  ì§€ì›ì„ í•¨ê»˜ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        > ì‹ ì²­ ê¸°ê°„ì„ ê¼­ í™•ì¸í•˜ì‹œê³ , ë°”ë¡œ ì‹¤í–‰í•´ë³´ì„¸ìš”! ì‘ì›í•©ë‹ˆë‹¤ ğŸ’ª

        ---
        """
        ),
        agent=agent,
        output_key="final_report",
        result_as_dict=True,
    )
