recommend_services_task:
  description: >
    키워드("{keywords}")를 사용하여 공공서비스 후보를 벡터 기반으로 검색하고,
    사용자 질문("{original_input}")과 프로필("{user_profile}")을 고려하여
    최종적으로 가장 적합한 1개 또는 2개의 공공서비스를 추천합니다.

    검색을 수행할 때는 다음 기준에 따라 적절한 툴을 사용해야 합니다:

    - **keywords만 존재**할 경우: vector_search_tool을 사용하여 키워드 기반 유사도 검색을 수행하세요.
    - **keywords와 함께 name 또는 region 필드가 존재**할 경우: vector_meta_search_tool을 사용하여 메타데이터 필터링 기반 검색을 수행하세요.

    name과 region 필터는 모두 **2글자 이하의 핵심 단어**로 구성되어야 하며,
    예: "경기패스" → name: "경기", "청년취업지원" → name: "청년",
        "경기도 남부" → region: "경기", "부산시 북구" → region: "부산"

    검색 결과의 내용을 분석하여, 사용자의 요구에 가장 부합하는 서비스를 선별하세요.

    단, 툴의 검색 결과가 "검색 결과가 없습니다"로 반환되면, 추가 검색을 시도하지 않고 그대로 사용자에게 '적합한 서비스를 찾을 수 없음'으로 응답하세요.
  expected_output: >
    최종 추천된 공공서비스 1개 또는 2개의 서비스 리스트입니다.
    각 항목은 사용자의 질문과 프로필에 가장 부합하는 정책입니다.
    각 항목은 다음 형식을 따릅니다:

    **[서비스명 또는 제목]**
    - 지역: ...
    - 지원대상: ...
    - 지원내용: ...
    - 링크: ...
    - 본문 요약: ...
  agent: recommend_service_selector

web_search_task:
  description: >
    사용자의 질문("{summary}")을 기반으로, 신뢰할 수 있는 정부 도메인(gov.kr, moel.go.kr 등)에서
    공공서비스 관련 정보를 Tavily 기반 웹 검색으로 수집합니다.

    중복된 정보를 줄이고 유용한 정책 정보를 중심으로 출력하세요.

    응답에는 제목, 서비스 실행 지역, 지원대상, 지원내용, 서비스 관련 링크, 본문 요약을 포함하여 깔끔하게 마크다운 형식으로 정리하세요.
  expected_output: >
    신뢰 가능한 출처에서 수집된 공공서비스 관련 정보 리스트입니다.
    각 항목은 다음 형식을 따릅니다:

    **[서비스명 또는 제목]**
    - 지역: ...
    - 지원대상: ...
    - 지원내용: ...
    - 링크: ...
    - 본문 요약: ...
  agent: web_search_agent

select_final_services_task:
  description: >
    수집된 공공서비스 리스트에서 중복된 항목들을 통합합니다.

    중복 여부는 서비스명, 키워드, 지원 내용 등을 기준으로 판단하되, 정보가 겹치지 않는 경우에는 상세 정보를 병합하여 하나의 서비스로 정리하세요. 만약 같은 서비스에 링크가 여러 개 존재할 경우, recommend_services_task의 링크를 우선적으로 사용합니다.

    통합된 서비스 리스트 중, 사용자의 질문("{original_input}")과 프로필("{user_profile}")에 가장 적합한 1개 또는 2개의 공공서비스를 최종 선택합니다.

    결과는 각 서비스의 이름, 지역, 지원대상, 지원내용, 링크, 본문 요약을 포함하는 마크다운 리스트 형식으로 작성해야 합니다.
  expected_output: >
    사용자에게 가장 적합한 공공서비스 1개 또는 2개의 정보 리스트 (중복 제거 후 통합된 상태).
    출력 형식 예:

    **[서비스명 또는 제목]**
    - 지역: ...
    - 지원대상: ...
    - 지원내용: ...
    - 링크: ...
    - 본문 요약: ...
  agent: final_service_selector
  context:
    - recommend_services_task
    - web_search_task

plan_application_strategy_task:
  description: >
    최종 추천된 공공서비스 리스트를 기반으로 신청 전략을 수립합니다.

    - 추천된 서비스가 **1개**일 경우:
      해당 서비스의 신청 요건, 신청 시기, 준비서류, 신청 대상 조건 등을 분석하여
      사용자가 빠르게 신청할 수 있도록 자세한 전략을 구성하세요.

    - 추천된 서비스가 **2개**일 경우:
      두 서비스를 비교 분석하여 **우선 신청 순위**를 판단하고,
      병행 신청이 가능한지 여부를 고려한 자세한 전략을 제시하세요.

    전략 수립은 사용자의 질문("{original_input}")과 프로필("{user_profile}")을 종합적으로 고려해
    맞춤형으로 작성되어야 하며, 실제 신청 흐름을 시뮬레이션하듯 구체적이고 실용적으로 구성되어야 합니다.
    전략 수립 과정에서 서비스 정보(신청 방법, 지원내용 등)가 부족하거나 누락된 경우,
    웹검색 툴(web_search_tool)을 사용하여 해당 서비스명 또는 사용자의 질문을 기반으로 보완 정보를 검색하세요.
    검색 대상은 최종 추천 서비스명입니다.

    출력은 마크다운 형식으로 작성하며, 각 전략은 명확하게 구분하여 표기하세요.
  expected_output: >
    공공서비스 신청 전략 안내서 (마크다운 표 형식으로 정리).

    출력 예시 (서비스가 1개일 경우):

    ### 서비스 A 신청 전략

    | 항목         | 내용                                    |
    |-------------|----------------------------------------|
    | 서비스명     | ...                                     |
    | 지원 내용    | ...                                     |
    | 신청 대상    | ...                                     |
    | 신청 시기    | ...                                     |
    | 준비 서류    | ...                                     |
    | 신청 방법    | ...                                     |
    | 전략 요약    | ...                                     |

    또는 (서비스가 2개일 경우):

    ### 두 서비스 비교 분석 및 전략

    | 항목              | 서비스 A(서비스명)                 | 서비스 B(서비스명)                 |
    |-------------------|---------------------------------|---------------------------------|
    | 신청 대상         | ...                              | ...                              |
    | 지원 내용         | ...                              | ...                              |
    | 신청 시기         | ...                              | ...                              |
    | 준비 서류         | ...                              | ...                              |
    | 신청 방법         | ...                              | ...                              |
    | 병행 신청 가능 여부 | ...                              | ...                              |
    | 추천 우선순위     | 1순위                             | 2순위                             |
  agent: strategy_planner
  context:
    - select_final_services_task

generate_recommendation_report_task:
  description: >
    최종 추천된 공공서비스 정보와 신청 전략을 기반으로,
    사용자에게 제공할 맞춤형 공공서비스 추천 보고서를 작성합니다.

    보고서에는 다음 내용을 포함해야 합니다:

    1. 사용자 질문 요약("{original_input}") 및 프로필("{user_profile}") 정리
    2. 추천된 공공서비스 개요 (서비스명, 상세 정보 포함)
    3. 각 서비스에 대한 신청 전략 (표 형식)
    4. 추천 사유 및 사용자에게 기대되는 혜택

    보고서는 마크다운 형식으로 구성되어야 하며, 각 섹션은 제목을 붙여 명확히 구분해야 합니다.
    사용자 요약을 제외하고는 모두 상세한 내용으로 작성되어야 합니다.
    각 서비스에 대한 설명은 사용자가 이해하기 쉽게 작성되어야 하며, 전문 용어는 피해야 합니다.
  expected_output: >
    사용자 맞춤 공공서비스 추천 보고서 (마크다운 형식).
    예시:
    # [서비스명 또는 제목]

    ### 📝 사용자 요약
    - 질문: ...
    - 지역: ...
    - 관심 분야: ...

    ### 🎯 추천 서비스
    
    - select_final_services_task의 결과

    ### 📌 신청 전략 (표)

    - plan_application_strategy_task의 결과

    ### 💡 추천 사유 및 기대 효과
    - ...
  agent: report_writer
  context:
    - select_final_services_task
    - plan_application_strategy_task
